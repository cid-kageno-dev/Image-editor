<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano Banana Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen font-sans">

    <div class="container mx-auto px-4 py-10 max-w-4xl">
        <h1 class="text-4xl font-bold text-yellow-400 mb-2 text-center">üçå Nano Banana Studio</h1>
        <p class="text-gray-400 text-center mb-10">Powered by Gemini 2.5 Flash Image</p>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="mb-6">
                    {% for category, message in messages %}
                        <div class="p-4 rounded bg-red-600 text-white text-center">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg h-fit">
                <div class="flex mb-6 border-b border-gray-700">
                    <button onclick="switchTab('generate')" id="tab-gen" class="flex-1 py-2 text-yellow-400 border-b-2 border-yellow-400 font-bold">Generator</button>
                    <button onclick="switchTab('edit')" id="tab-edit" class="flex-1 py-2 text-gray-400">Editor</button>
                </div>

                <form action="/" method="POST" enctype="multipart/form-data" id="main-form">
                    <input type="hidden" name="action" id="action-input" value="generate">

                    <div id="upload-section" class="hidden mb-4">
                        <label class="block text-sm font-bold mb-2">Upload Source Image:</label>
                        <input type="file" name="init_image" accept="image/*" class="w-full bg-gray-700 p-2 rounded border border-gray-600">
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-bold mb-2">Prompt / Instruction:</label>
                        <textarea name="prompt" rows="4" class="w-full bg-gray-700 p-3 rounded border border-gray-600 focus:outline-none focus:border-yellow-400" placeholder="Describe the image you want...">{{ prompt }}</textarea>
                    </div>

                    <button type="submit" class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3 rounded transition">
                        Run Nano Banana üçå
                    </button>
                </form>
            </div>

            <div class="bg-gray-800 p-6 rounded-xl shadow-lg flex flex-col items-center justify-center min-h-[400px]">
                {% if generated_image %}
                    <img src="data:image/png;base64,{{ generated_image }}" alt="Generated Result" class="rounded shadow-lg max-w-full h-auto">
                    <a href="data:image/png;base64,{{ generated_image }}" download="nano_banana_result.png" class="mt-4 text-sm text-yellow-400 hover:underline">Download Image</a>
                {% else %}
                    <div class="text-gray-500 text-center">
                        <p class="text-6xl mb-4">üñºÔ∏è</p>
                        <p>Result will appear here</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        function switchTab(mode) {
            document.getElementById('action-input').value = mode;
            document.getElementById('upload-section').classList.toggle('hidden', mode === 'generate');
            
            // Update Tab Styles
            const genTab = document.getElementById('tab-gen');
            const editTab = document.getElementById('tab-edit');
            
            if(mode === 'generate'){
                genTab.className = "flex-1 py-2 text-yellow-400 border-b-2 border-yellow-400 font-bold";
                editTab.className = "flex-1 py-2 text-gray-400";
            } else {
                editTab.className = "flex-1 py-2 text-yellow-400 border-b-2 border-yellow-400 font-bold";
                genTab.className = "flex-1 py-2 text-gray-400";
            }
        }
    </script>
</body>
</html>
